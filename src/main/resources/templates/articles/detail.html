<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<title th:text="${article.title}">Article</title>
<link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
	<div class="navbar">
		<a href="/articles">Articles</a> | <a href="/logout">Logout</a>
	</div>

	<div class="container">
		<h2 th:text="${article.title}"></h2>

		<p th:if="${article.subTitle != null}"
			style="font-style: italic; color: gray;"
			th:text="${article.subTitle}"></p>

		<p>
			<small> by <span th:text="${article.author.name}"></span>, <span
				th:text="${#dates.format(article.createdOn, 'dd MMM yyyy HH:mm')}"></span>
				<span th:if="${article.updatedOn != null}"> (Updated on <span
					th:text="${#dates.format(article.updatedOn, 'dd MMM yyyy HH:mm')}"></span>)
			</span>
			</small>
		</p>

		<p th:text="${article.content}"></p>

		<div th:if="${authUser != null and authUser.id == article.author.id}"
			class="mt-3">
			<a th:href="@{'/articles/' + ${article.id} + '/edit'}">Edit</a> |
			<form th:action="@{'/articles/' + ${article.id} + '/delete'}"
				method="post" style="display: inline;">
				<button type="submit"
					onclick="return confirm('Are you sure you want to delete this article?')">
					Delete</button>
			</form>
		</div>

		<hr />
		<h3>Comments</h3>
		<ul>
			<li th:each="comment : ${comments}">
				<div class="comment-box">
					<p th:text="${comment.comment}"></p>
					<small> — <span th:text="${comment.commentor.name}"></span>
						<span
						th:text="${#dates.format(comment.createdOn, 'dd MMM yyyy HH:mm')}"></span>
						<span th:if="${comment.updatedOn != null}"> (Updated on <span
							th:text="${#dates.format(comment.updatedOn, 'dd MMM yyyy HH:mm')}"></span>)
					</span>
					</small>

					<div
						th:if="${authUser != null and authUser.id == comment.commentor.id}"
						class="mt-2">
						<form
							th:action="@{'/articles/' + ${article.id} + '/comments/' + ${comment.id} + '/edit'}"
							method="post" style="display: inline;">
							<input type="text" name="updatedComment"
								placeholder="Edit your comment" required />
							<button type="submit">Update</button>
						</form>
						<form
							th:action="@{'/articles/' + ${article.id} + '/comments/' + ${comment.id} + '/delete'}"
							method="post" style="display: inline;">
							<button type="submit"
								onclick="return confirm('Are you sure you want to delete this comment?')">
								Delete</button>
						</form>
					</div>
				</div>
			</li>
		</ul>

		<!-- Comment form -->
		<hr />
		<h4>Add a Comment</h4>
		<form th:action="@{/articles/{id}/comments(id=${article.id})}"
			method="post">
			<textarea name="comment" rows="3" cols="40"
				placeholder="Write your comment..." required></textarea>
			<br />
			<button type="submit">Post Comment</button>
		</form>

		<div class="text-center mt-3">
			<a href="/articles">← Back to Articles</a>
		</div>
	</div>
</body>
</html>
